# Target configuration for STM32F103C8T6
set _CHIPNAME stm32f103c8t6
set _TARGETNAME $_CHIPNAME.cpu

# Create a DAP (Debug Access Port)
dap create $_CHIPNAME.dap cortex_m3

# Create the target using -dap parameter
target create $_TARGETNAME cortex_m -endian little -dap $_CHIPNAME.dap

# Flash configuration
flash bank $_CHIPNAME.flash stm32f1x 0x08000000 0x20000 0 0 $_TARGETNAME

# Reset configuration
reset_config srst_only srst_nogate

# Work area in SRAM (64KB available)
$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size 0x1000 -work-area-backup

# Halt the target on reset
init
halt

# Optional: Uncomment to enable trace output (SWO)
# tpiu config external uart off 72000000 2000000
